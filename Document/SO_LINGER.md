setsockopt 设置 SO_LINGER 选项：作用就是在close关闭时，保证发送数据发送到对方后，再彻底关闭连接。


当套接口关闭时内核将拖延一段时间（由l_linger决定）。如果套接口缓冲区中仍残留数据，进程将处于睡眠状态，直到

	（a）所有数据发送完且被对方确认，之后进行正常的终止序列（描述字访问计数为0）或
	（b）延迟时间到。

此种情况下，应用程序检查close的返回值是非常重要的，因为要区分两种状态：

如果在数据发送完并被确认前时间到，close将返回EWOULDBLOCK错误且套接口发送缓冲区中的任何数据都丢失。

如果数据发送完并被确认后，指定的时间才到，close的成功返回仅告诉我们发送的数据（和FIN）已由对方TCP确认，它并不能告诉我们对方应用进程是否已读了数据。如果套接口设为非阻塞的，它将不等待close完成。


https://www.cnblogs.com/cz-blog/p/4530641.html